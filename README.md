# 数字孪生可视化平台

## 项目概述

基于 Vue3 + Element Plus + AntV X6 技术栈开发的数字孪生可视化平台，实现了孪生体与系统孪生体的层级嵌套展示、拖拽交互、自动布局和抽屉式编辑功能。

## 技术栈

- **框架**: Vue 3 (script setup 语法糖) + TypeScript
- **UI组件库**: Element Plus 2.4+
- **图形引擎**: AntV X6 2.18+
- **状态管理**: Pinia
- **构建工具**: Vite
- **代码规范**: ESLint + Prettier

## 功能特性

### 1. 节点管理
- **孪生体节点**: 基础实体节点，可包含属性、方法等信息
- **系统孪生体节点**: 组节点，可包含多个子节点形成层级结构
- 支持节点的创建、编辑、删除操作

### 2. 拖拽交互
- 支持节点自由拖拽
- 拖拽校验：仅允许将节点拖拽到系统组内部
- 拖拽完成后自动更新节点的父子关系
- 拖拽过程中的视觉反馈

### 3. 自动布局
- **居中排布**: 孪生体拖入系统组时自动居中显示
- **自动换行**: 组内节点超过5个时自动换行排布
- **动态调整**: 根据子节点数量动态调整组节点尺寸

### 4. 编辑功能
- **孪生体编辑**: 包含概览、属性、方法、规划四个标签页
- **系统组编辑**: 包含子成员管理功能
- **预览/编辑模式**: 支持两种模式切换，默认为预览模式
- **数据验证**: 完整的表单验证和数据合法性检查

### 5. 数据持久化
- 使用 Pinia 统一管理节点数据
- 支持本地 localStorage 持久化
- 刷新页面后可恢复原有数据状态

## 项目结构

```
src/
├── types/                  # TypeScript 类型定义
│   └── twin.d.ts          # 孪生体相关接口定义
├── stores/                # Pinia 状态管理
│   └── twinStore.ts       # 孪生体数据存储
├── components/            # 组件目录
│   ├── x6/               # AntV X6 相关组件
│   │   └── X6Graph.vue   # 画布核心组件
│   ├── twin-entity/      # 孪生体组件
│   │   ├── TwinNode.vue  # 孪生体节点渲染
│   │   └── TwinDrawer.vue # 孪生体编辑抽屉
│   └── system-twin-group/ # 系统孪生体组件
│       └── SystemGroupDrawer.vue # 系统组编辑抽屉
├── composables/          # 组合式函数
│   ├── useDrag.ts        # 拖拽交互逻辑
│   ├── useLayout.ts      # 自动布局算法
│   └── useDrawer.ts      # 抽屉管理逻辑
├── utils/                # 工具函数
│   └── layoutHelper.ts   # 布局计算工具
├── styles/               # 样式文件
│   └── index.scss        # 全局样式
└── views/                # 页面视图
    └── TwinVisualization.vue # 主视图页面
```

## 快速开始

### 安装依赖

```bash
npm install
```

### 启动开发服务器

```bash
npm run dev
```

访问 `http://localhost:5173` 查看应用

### 构建生产版本

```bash
npm run build
```

### 代码检查和格式化

```bash
# ESLint 检查并自动修复
npm run lint

# Prettier 格式化代码
npm run format
```

## 使用指南

### 1. 创建节点

- 点击工具栏的"新建孪生体"按钮创建基础节点
- 点击"新建系统组"按钮创建可包含子节点的组节点

### 2. 拖拽操作

- 按住节点并拖拽到目标系统组内可建立父子关系
- 拖拽到画布空白区域可将节点移回根节点层级
- 系统会自动阻止非法拖拽操作（如循环引用）

### 3. 编辑节点

- **双击节点**：以预览模式打开编辑抽屉
- **点击节点编辑按钮**：以编辑模式打开抽屉
- 在抽屉中可以修改节点的各种属性

### 4. 布局管理

- 系统会自动处理节点的布局排布
- 可以通过工具栏的"自动布局"按钮重新整理所有节点

### 5. 数据管理

- 所有操作都会自动保存到本地存储
- 刷新页面后数据会自动恢复
- 可以通过"清空画布"按钮重置所有数据

## 核心组件说明

### X6Graph.vue
AntV X6 画布组件，负责节点的可视化渲染和基础交互。

### TwinNode.vue
孪生体节点组件，提供节点的视觉展示和基础交互。

### useDrag.ts
拖拽交互逻辑，处理节点拖拽的开始、移动和结束事件。

### useLayout.ts
自动布局算法，计算节点的位置和组节点的尺寸。

### twinStore.ts
Pinia 状态管理，维护所有节点数据的一致性。

## 开发规范

### 代码风格
- 使用 TypeScript 进行类型约束
- 遵循 ESLint 和 Prettier 规范
- 组件使用 script setup 语法糖
- 变量和函数采用语义化命名

### 提交规范
- 使用 conventional commits 规范
- 提交信息格式：`<type>(<scope>): <subject>`

### 目录规范
- 组件按功能模块组织
- 工具函数按用途分类
- 类型定义集中管理

## 性能优化

- 使用防抖处理高频事件
- 实现按需渲染减少重绘
- 合理使用 computed 和 watch
- 组件懒加载优化

## 浏览器兼容性

- Chrome 90+
- Edge 90+
- Firefox 88+
- Safari 14+

## 已知问题

1. 部分 TypeScript 类型检查可能存在警告（不影响功能）
2. 大量节点时可能存在渲染性能问题
3. 某些复杂布局场景下的自动调整可能不够智能

## 后续优化方向

1. 增加更多节点类型和样式
2. 实现节点连接线和关系展示
3. 添加历史记录和撤销重做功能
4. 支持数据导入导出
5. 增加更多布局算法选项
6. 实现节点模板和批量操作

## 贡献指南

欢迎提交 Issue 和 Pull Request 来帮助改进项目。

## 许可证

MIT License