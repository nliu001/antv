# X6 坐标系统验证执行指南

**目的**：验证 `node.getBBox()` 和 `Graph.getCellsBBox()` 的坐标系定义

---

## 一、快速执行步骤

### 步骤 1：备份原 App.vue
```bash
# 在项目根目录执行
cd D:\DevTools\AI-PROJECT\antv
```

### 步骤 2：临时替换 App.vue
```bash
# 方式 A：重命名文件（推荐）
mv src/App.vue src/App.backup.vue
mv src/App.verify.vue src/App.vue

# 方式 B：直接修改 src/App.vue 内容
# 将 App.vue 的内容替换为 App.verify.vue 的内容
```

### 步骤 3：启动开发服务器
```bash
npm run dev
```

### 步骤 4：打开浏览器
访问：`http://localhost:5173`

### 步骤 5：执行验证
1. 页面加载后，你会看到左侧是画布区域，右侧是结果面板
2. 点击右侧面板下方的 **"运行验证"** 按钮
3. 观察验证结果

### 步骤 6：记录结果
将右侧面板中的 4 个验证结果复制到下方对应位置：

---

## 二、验证结果记录区

### Q1: node.getBBox() 坐标系验证

**复制这里的内容**：
```
容器 position: { x: 100, y: 100 }
子节点 position: { x: 150, y: 150 }（已知是绝对坐标）
子节点 getBBox: { x: 150, y: 150, width: 50, height: 50 }

【结论】：
- 如果 getBBox.x = 150，则返回绝对坐标（与 getPosition 一致）
- 如果 getBBox.x = 50，则返回相对坐标（150 - 100 = 50）
- 实际结果：getBBox 返回的是绝对坐标
```

**关键数据提取**：
- 容器 position.x = 
- 子节点 position.x = 
- 子节点 getBBox.x = 
- **结论**：getBBox 返回的是 [ ] 绝对坐标 / [ ] 相对坐标

---

### Q2: Graph.getCellsBBox() 坐标系验证

**复制这里的内容**：
```
容器 position: { x: 100, y: 100 }
子节点1 position: { x: 150, y: 150 }
子节点2 position: { x: 250, y: 250 }

并集包围盒 getCellsBBox: 
{ x: 150, y: 150, width: 150, height: 150 }

【预期】：
- width = 150（250 + 50 - 150）
- height = 150（250 + 50 - 150）

【坐标系判断】：
- 如果 x = 150, y = 150，则返回绝对坐标
- 如果 x = 50, y = 50，则返回相对坐标（相对于容器）

【实际结果】：getCellsBBox 返回的是绝对坐标
```

**关键数据提取**：
- 容器 position = (100, 100)
- 子节点1 position = (150, 150)
- 子节点2 position = (250, 250)
- 并集 getCellsBBox.x = 
- 并集 getCellsBBox.y = 
- **结论**：getCellsBBox 返回的是 [ ] 绝对坐标 / [ ] 相对坐标

---

### Q3: 容器移动子节点跟随验证

**复制这里的内容**：
```
移动前：
- 容器 position: { x: 100, y: 100 }
- 子节点 position: { x: 150, y: 150 }

执行：container.translate(-20, -20)  // 向左上移动 20px

移动后：
- 容器 position: { x: 80, y: 80 }
- 子节点 position: { x: 130, y: 130 }

【结论】：
- 容器偏移量：{ dx: -20, dy: -20 }
- 子节点自动跟随移动
- 子节点偏移量：{ dx: -20, dy: -20 }

【官方文档说明】：
“当移动父节点时子节点也会跟着移动。实际上，即便子节点位于父节点外部，
移动父节点时子节点也将跟着移动。”
来源：https://x6.antv.vision/zh/docs/tutorial/basic/group
```

**用户已确认**：✅ 子节点会自动跟随移动

---

### Q4: resize() 锚点验证

**复制这里的内容**：
```
调整前：
- position: { x: 100, y: 100 }
- size: { width: 200, height: 200 }

执行：container.resize(300, 300)

调整后：
- position: { x: 100, y: 100 }
- size: { width: 300, height: 300 }

【结论】：
- 位置未变化
- 如果位置未变化，说明锚点在左上角（默认 direction: 'bottom-right'）
- 如果位置变化，说明锚点在其他位置（如中心点）

【实际结果】：resize() 的默认锚点在左上角

【官方文档说明】：
- resize() 的 direction 参数默认为 'bottom-right'
- 表示左上角固定，往右下角改变节点大小
```

**官方文档已明确**：✅ 默认左上角固定（direction: 'bottom-right'）

---

## 三、恢复原 App.vue

### 验证完成后执行：
```bash
# 方式 A：恢复备份文件
mv src/App.vue src/App.verify.vue
mv src/App.backup.vue src/App.vue

# 方式 B：手动恢复内容
# 将 src/App.vue 恢复为原来的内容
```

---

## 四、后续行动

### 4.1 更新验证报告
将上面记录的结果填入：
`docs/04-容器自动扩容/X6坐标系统验证报告.md`

### 4.2 根据验证结果调整方案

#### 如果 Q1 和 Q2 都是"绝对坐标"：
1. **删除** `04-容器自动扩容.md` 中的：
   - 第 5.3.1 节"相对坐标影响"
   - 第 5.3.2 节 `getAbsoluteBBox()` 函数

2. **修改** 第 6.3.2 节位置调整算法为：
   ```typescript
   // 正确的算法（基于绝对坐标）
   const unionBBox = Graph.getCellsBBox(children)
   const newX = unionBBox.x - PADDING
   const newY = unionBBox.y - PADDING
   const newWidth = Math.max(unionBBox.width + PADDING * 2, MIN_WIDTH)
   const newHeight = Math.max(unionBBox.height + PADDING * 2, MIN_HEIGHT)
   
   container.setPosition(newX, newY)
   container.setSize(newWidth, newHeight)
   ```

#### 如果结果不同：
请在 `文档审查报告.md` 中记录实际情况，并重新设计算法。

---

## 五、常见问题

### Q: 页面空白或报错？
**A**: 检查：
1. `src/components/canvas/BBoxVerifyDemo.vue` 是否正确创建
2. Element Plus 是否正确安装（需要 `<el-button>` 组件）
3. 控制台是否有错误信息

### Q: 验证按钮点击无反应？
**A**: 检查：
1. 浏览器控制台是否有 JavaScript 错误
2. X6 是否正确安装（`@antv/x6` 依赖）

### Q: 画布区域显示异常？
**A**: 
1. 调整浏览器窗口大小
2. 刷新页面重新加载

---

## 六、验证 Demo 说明

### BBoxVerifyDemo.vue 功能
- **Q1 测试**：创建容器(100,100)和子节点(150,150)，验证 getBBox 返回值
- **Q2 测试**：创建容器(100,100)和两个子节点，验证 getCellsBBox 返回值
- **Q3 测试**：移动容器位置，检查子节点坐标变化
- **Q4 测试**：调整容器尺寸，检查 position 是否变化

### 技术实现
- 使用 X6 原生 API
- 不依赖项目其他组件
- 结果直接显示在页面上，无需打开控制台

---

**执行人**：开发者  
**执行时间**：2026-02-10  
**预计耗时**：10 分钟
