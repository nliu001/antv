# 04-å®¹å™¨è‡ªåŠ¨æ‰©å®¹æ–¹æ¡ˆé‡æ–°è¯„ä¼°æŠ¥å‘Š

**è¯„ä¼°æ—¥æœŸ**ï¼š2026-02-10  
**è¯„ä¼°ä¾æ®**ï¼šX6 å®˜æ–¹æ–‡æ¡£éªŒè¯ + BBoxVerifyDemo å®æµ‹ç»“æœ  
**åŸæ–¹æ¡ˆæ–‡æ¡£**ï¼š`docs/steps/04-å®¹å™¨è‡ªåŠ¨æ‰©å®¹.md`  
**è¯„ä¼°ç»“è®º**ï¼šğŸ”´ **å­˜åœ¨ä¸¥é‡é”™è¯¯ï¼Œå¿…é¡»ä¿®æ­£**

---

## ç›®å½•
- [ä¸€ã€è¯„ä¼°æ¦‚è¿°](#ä¸€è¯„ä¼°æ¦‚è¿°)
- [äºŒã€ä¸¥é‡é”™è¯¯åˆ—è¡¨](#äºŒä¸¥é‡é”™è¯¯åˆ—è¡¨)
- [ä¸‰ã€éœ€è¦åˆ é™¤çš„é”™è¯¯å†…å®¹](#ä¸‰éœ€è¦åˆ é™¤çš„é”™è¯¯å†…å®¹)
- [å››ã€éœ€è¦ä¿®æ­£çš„æ ¸å¿ƒç®—æ³•](#å››éœ€è¦ä¿®æ­£çš„æ ¸å¿ƒç®—æ³•)
- [äº”ã€éœ€è¦è¡¥å……çš„å…³é”®çŸ¥è¯†](#äº”éœ€è¦è¡¥å……çš„å…³é”®çŸ¥è¯†)
- [å…­ã€ä¿®æ­£å»ºè®®æ±‡æ€»](#å…­ä¿®æ­£å»ºè®®æ±‡æ€»)

---

## ä¸€ã€è¯„ä¼°æ¦‚è¿°

### 1.1 éªŒè¯ç»“æœæ‘˜è¦

æ ¹æ® `X6åæ ‡ç³»ç»ŸéªŒè¯æŠ¥å‘Š.md` å’Œ `éªŒè¯æ‰§è¡ŒæŒ‡å—.md`ï¼Œå·²ç¡®è®¤ä»¥ä¸‹äº‹å®ï¼š

| éªŒè¯é¡¹ | åŸæ–¹æ¡ˆå‡è®¾ | éªŒè¯ç»“æœ | å½±å“ |
|-------|-----------|---------|------|
| Q1: `getBBox()` åæ ‡ç³» | âŒ ç›¸å¯¹åæ ‡ | âœ… **ç»å¯¹åæ ‡** | ğŸ”´ ä¸¥é‡ |
| Q2: `getCellsBBox()` åæ ‡ç³» | âŒ ç›¸å¯¹åæ ‡ | âœ… **ç»å¯¹åæ ‡** | ğŸ”´ ä¸¥é‡ |
| Q3: å­èŠ‚ç‚¹è·Ÿéšç§»åŠ¨ | âœ… ä¼šè·Ÿéš | âœ… ä¼šè·Ÿéšï¼ˆéœ€ç”¨ `translate()`ï¼‰ | âš ï¸ éœ€ä¿®æ­£ |
| Q4: `resize()` é”šç‚¹ | âœ… å·¦ä¸Šè§’å›ºå®š | âœ… å·¦ä¸Šè§’å›ºå®š | âœ… æ­£ç¡® |

### 1.2 è¯„ä¼°ç»“è®º

- **è‡´å‘½é”™è¯¯**ï¼šåæ ‡ç³»ç»Ÿå‡è®¾å®Œå…¨é”™è¯¯ï¼ˆç¬¬ 5.3 èŠ‚ï¼‰
- **ç®—æ³•é”™è¯¯**ï¼šä½ç½®è°ƒæ•´ç®—æ³•åŸºäºé”™è¯¯çš„åæ ‡å‡è®¾ï¼ˆç¬¬ 6.3.2 èŠ‚ï¼‰
- **æ–¹æ³•é”™è¯¯**ï¼šä½¿ç”¨ `position()` è€Œé `translate()` ä¼šå¯¼è‡´å­èŠ‚ç‚¹ä¸è·Ÿéš

---

## äºŒã€ä¸¥é‡é”™è¯¯åˆ—è¡¨

### ğŸ”´ é”™è¯¯ 1ï¼šåæ ‡ç³»ç»Ÿé”™è¯¯å‡è®¾

**ä½ç½®**ï¼šç¬¬ 5.3.1 èŠ‚ "ç›¸å¯¹åæ ‡å½±å“"

**é”™è¯¯å†…å®¹**ï¼š
```markdown
#### 5.3.1 ç›¸å¯¹åæ ‡å½±å“
- å­èŠ‚ç‚¹çš„ `getBBox()` è¿”å›çš„æ˜¯**ç›¸å¯¹äºçˆ¶å®¹å™¨**çš„åæ ‡
- è®¡ç®—å¹¶é›†åŒ…å›´ç›’æ—¶éœ€è¦ç¡®ä¿åæ ‡ç³»ç»Ÿä¸€è‡´
```

**éªŒè¯ç»“æœ**ï¼š
- âŒ `getBBox()` è¿”å›çš„æ˜¯**ç»å¯¹åæ ‡**ï¼ˆç›¸å¯¹äºç”»å¸ƒï¼‰
- âŒ `getCellsBBox()` è¿”å›çš„ä¹Ÿæ˜¯**ç»å¯¹åæ ‡**

**å®˜æ–¹æ–‡æ¡£ä¾æ®**ï¼š
> `node.position()` é»˜è®¤è¿”å›**ç»å¯¹åæ ‡**ï¼ˆç›¸å¯¹äºç”»å¸ƒï¼‰ï¼Œéœ€ä¼ å…¥ `{ relative: true }` æ‰è¿”å›ç›¸å¯¹åæ ‡ã€‚
>
> æ¥æºï¼šhttps://x6.antv.vision/zh/docs/api/model/node#position

**å½±å“èŒƒå›´**ï¼š
- âŒ å¯¼è‡´ç¬¬ 5.3.2 èŠ‚ `getAbsoluteBBox()` å‡½æ•°å®Œå…¨ä¸å¿…è¦
- âŒ å¯¼è‡´ç¬¬ 6.3.2 èŠ‚ä½ç½®è°ƒæ•´ç®—æ³•é”™è¯¯
- âŒ è¯¯å¯¼å¼€å‘è€…è¿›è¡Œé”™è¯¯çš„åæ ‡è½¬æ¢

---

### ğŸ”´ é”™è¯¯ 2ï¼šä¸å¿…è¦çš„åæ ‡è½¬æ¢å‡½æ•°

**ä½ç½®**ï¼šç¬¬ 5.3.2 èŠ‚ "ç»å¯¹åæ ‡è½¬æ¢"

**é”™è¯¯å†…å®¹**ï¼š
```typescript
function getAbsoluteBBox(node: Node): BBox {
  const bbox = node.getBBox()
  const parent = node.getParent()
  
  if (!parent) {
    return bbox
  }
  
  const parentPos = parent.position()
  return {
    x: bbox.x + parentPos.x,
    y: bbox.y + parentPos.y,
    width: bbox.width,
    height: bbox.height
  }
}
```

**é”™è¯¯åŸå› **ï¼š
1. âŒ `node.getBBox()` å·²ç»è¿”å›ç»å¯¹åæ ‡ï¼Œä¸éœ€è¦å†åŠ ä¸Šçˆ¶èŠ‚ç‚¹åæ ‡
2. âŒ è¿™ä¸ªå‡½æ•°ä¼šå¯¼è‡´åæ ‡è¢«**é‡å¤è®¡ç®—**ï¼ˆbbox.x å·²ç»æ˜¯ç»å¯¹å€¼ï¼Œå†åŠ  parentPos.x ä¼šé”™è¯¯ï¼‰

**æ­£ç¡®åšæ³•**ï¼š
```typescript
// âœ… ç›´æ¥ä½¿ç”¨ getBBox()ï¼Œæ— éœ€è½¬æ¢
const bbox = node.getBBox()  // å·²ç»æ˜¯ç»å¯¹åæ ‡
```

---

### ğŸ”´ é”™è¯¯ 3ï¼šä½ç½®è°ƒæ•´ç®—æ³•é”™è¯¯

**ä½ç½®**ï¼šç¬¬ 6.3.2 èŠ‚ "è°ƒæ•´è®¡ç®—"

**é”™è¯¯å†…å®¹**ï¼š
```typescript
// è®¡ç®—å­èŠ‚ç‚¹åŒ…å›´ç›’ç›¸å¯¹äºå®¹å™¨å†…éƒ¨çš„åç§»
const offsetX = unionBBox.x - PADDING
const offsetY = unionBBox.y - PADDING

// å¦‚æœåç§»è¶…è¿‡é˜ˆå€¼ï¼Œè°ƒæ•´å®¹å™¨ä½ç½®
if (Math.abs(offsetX) > THRESHOLD || Math.abs(offsetY) > THRESHOLD) {
  const currentPos = container.position()
  container.position(
    currentPos.x + offsetX,
    currentPos.y + offsetY
  )
}
```

**é”™è¯¯åˆ†æ**ï¼š
1. âŒ `unionBBox.x` æ˜¯ç»å¯¹åæ ‡ï¼Œä¸æ˜¯ç›¸å¯¹äºå®¹å™¨çš„åç§»
2. âŒ `offsetX = unionBBox.x - PADDING` è®¡ç®—å‡ºæ¥çš„ä¸æ˜¯åç§»é‡ï¼Œè€Œæ˜¯æ–°çš„ç»å¯¹åæ ‡
3. âŒ `container.position(currentPos.x + offsetX, ...)` ä¼šå¯¼è‡´å®¹å™¨ä½ç½®é”™è¯¯

**æ­£ç¡®ç®—æ³•**ï¼š
```typescript
// âœ… æ­£ç¡®ï¼šunionBBox.x æ˜¯ç»å¯¹åæ ‡ï¼Œç›´æ¥å‡å» PADDING å¾—åˆ°å®¹å™¨æ–°ä½ç½®
const newX = unionBBox.x - PADDING
const newY = unionBBox.y - PADDING

// âœ… è®¡ç®—åç§»é‡ï¼ˆç”¨äº translateï¼‰
const oldPos = container.getPosition()
const dx = newX - oldPos.x
const dy = newY - oldPos.y

// âœ… ä½¿ç”¨ translate() ç§»åŠ¨å®¹å™¨ï¼ˆå­èŠ‚ç‚¹ä¼šè‡ªåŠ¨è·Ÿéšï¼‰
if (Math.abs(dx) > THRESHOLD || Math.abs(dy) > THRESHOLD) {
  container.translate(dx, dy)
}
```

---

### âš ï¸ é”™è¯¯ 4ï¼šä½¿ç”¨é”™è¯¯çš„ç§»åŠ¨æ–¹æ³•

**ä½ç½®**ï¼šç¬¬ 6.3.2 èŠ‚ã€ç¬¬ 8.1.3 èŠ‚

**é”™è¯¯å†…å®¹**ï¼š
```typescript
container.position(currentPos.x + offsetX, currentPos.y + offsetY)
```

**éªŒè¯ç»“æœ**ï¼š
- âŒ `setPosition()` æˆ– `position()` **ä¸ä¼š**è§¦å‘å­èŠ‚ç‚¹è·Ÿéš
- âœ… å¿…é¡»ä½¿ç”¨ `translate(dx, dy)` æ‰èƒ½è®©å­èŠ‚ç‚¹è‡ªåŠ¨è·Ÿéš

**å®˜æ–¹æ–‡æ¡£ä¾æ®**ï¼š
> "å½“ç§»åŠ¨çˆ¶èŠ‚ç‚¹æ—¶å­èŠ‚ç‚¹ä¹Ÿä¼šè·Ÿç€ç§»åŠ¨ã€‚å®é™…ä¸Šï¼Œå³ä¾¿å­èŠ‚ç‚¹ä½äºçˆ¶èŠ‚ç‚¹å¤–éƒ¨ï¼Œç§»åŠ¨çˆ¶èŠ‚ç‚¹æ—¶å­èŠ‚ç‚¹ä¹Ÿå°†è·Ÿç€ç§»åŠ¨ã€‚"
>
> æ¥æºï¼šhttps://x6.antv.vision/zh/docs/tutorial/basic/group

**Q3 éªŒè¯ç»“æœ**ï¼š
```
ä½¿ç”¨ container.translate(-20, -20) åï¼š
- å®¹å™¨ï¼š(100, 100) â†’ (80, 80) âœ…
- å­èŠ‚ç‚¹ï¼š(150, 150) â†’ (130, 130) âœ… è‡ªåŠ¨è·Ÿéš
```

**æ­£ç¡®ç”¨æ³•**ï¼š
```typescript
// âŒ é”™è¯¯ï¼šå­èŠ‚ç‚¹ä¸ä¼šè·Ÿéš
container.setPosition(newX, newY)

// âœ… æ­£ç¡®ï¼šå­èŠ‚ç‚¹è‡ªåŠ¨è·Ÿéš
const dx = newX - container.getPosition().x
const dy = newY - container.getPosition().y
container.translate(dx, dy)
```

---

### âš ï¸ é”™è¯¯ 5ï¼šAPI ä½¿ç”¨é”™è¯¯

**ä½ç½®**ï¼šç¬¬ 5.2.2 èŠ‚ "å¤šèŠ‚ç‚¹å¹¶é›†åŒ…å›´ç›’"

**é”™è¯¯å†…å®¹**ï¼š
```typescript
const unionBBox = Graph.getCellsBBox(children)
```

**é”™è¯¯åŸå› **ï¼š
- âŒ `getCellsBBox()` æ˜¯ **graph å®ä¾‹æ–¹æ³•**ï¼Œä¸æ˜¯ `Graph` ç±»çš„é™æ€æ–¹æ³•
- âŒ è¿™æ ·è°ƒç”¨ä¼šæŠ¥é”™ï¼š`Graph.getCellsBBox is not a function`

**æ­£ç¡®ç”¨æ³•**ï¼š
```typescript
// âœ… æ­£ç¡®ï¼šé€šè¿‡ graph å®ä¾‹è°ƒç”¨
const unionBBox = graph.getCellsBBox(children)
```

**å‚è€ƒ**ï¼š`APIä¿®æ­£è¯´æ˜.md`

---

## ä¸‰ã€éœ€è¦åˆ é™¤çš„é”™è¯¯å†…å®¹

### 3.1 åˆ é™¤æ¸…å•

| ç« èŠ‚ | æ ‡é¢˜ | åˆ é™¤åŸå›  |
|-----|------|---------|
| 5.3.1 | ç›¸å¯¹åæ ‡å½±å“ | âŒ åæ ‡å‡è®¾é”™è¯¯ |
| 5.3.2 | ç»å¯¹åæ ‡è½¬æ¢ | âŒ ä¸å¿…è¦çš„é”™è¯¯å‡½æ•° |
| 6.3.2 | è°ƒæ•´è®¡ç®—ï¼ˆéƒ¨åˆ†ï¼‰ | âŒ ç®—æ³•é€»è¾‘é”™è¯¯ |

### 3.2 å…·ä½“å†…å®¹

#### åˆ é™¤ 5.3.1 èŠ‚
```markdown
#### 5.3.1 ç›¸å¯¹åæ ‡å½±å“
- å­èŠ‚ç‚¹çš„ `getBBox()` è¿”å›çš„æ˜¯**ç›¸å¯¹äºçˆ¶å®¹å™¨**çš„åæ ‡
- è®¡ç®—å¹¶é›†åŒ…å›´ç›’æ—¶éœ€è¦ç¡®ä¿åæ ‡ç³»ç»Ÿä¸€è‡´
```

#### åˆ é™¤ 5.3.2 èŠ‚
```markdown
#### 5.3.2 ç»å¯¹åæ ‡è½¬æ¢
å¦‚æœéœ€è¦ç»å¯¹åæ ‡ï¼š
```typescript
function getAbsoluteBBox(node: Node): BBox {
  // ... æ•´ä¸ªå‡½æ•°åˆ é™¤
}
```
```

---

## å››ã€éœ€è¦ä¿®æ­£çš„æ ¸å¿ƒç®—æ³•

### 4.1 ç¬¬ 6.1.1 èŠ‚"ç®—æ³•ä¼ªç "ä¿®æ­£

**åŸé”™è¯¯ç®—æ³•**ï¼š
```typescript
// 7. è°ƒæ•´å®¹å™¨ä½ç½®ï¼ˆä¿æŒå­èŠ‚ç‚¹è§†è§‰ä½ç½®ï¼‰
offsetX = unionBBox.x - PADDING
offsetY = unionBBox.y - PADDING

if (abs(offsetX) > THRESHOLD || abs(offsetY) > THRESHOLD) {
  currentPos = container.position()
  container.position(
    currentPos.x + offsetX,
    currentPos.y + offsetY
  )
}
```

**æ­£ç¡®ç®—æ³•**ï¼š
```typescript
// 7. è°ƒæ•´å®¹å™¨ä½ç½®ï¼ˆä½¿ç”¨ translate è®©å­èŠ‚ç‚¹è‡ªåŠ¨è·Ÿéšï¼‰
newX = unionBBox.x - PADDING
newY = unionBBox.y - PADDING

oldPos = container.getPosition()
dx = newX - oldPos.x
dy = newY - oldPos.y

if (abs(dx) > THRESHOLD || abs(dy) > THRESHOLD) {
  container.translate(dx, dy)  // âœ… å…³é”®ï¼šä½¿ç”¨ translate()
}
```

---

### 4.2 ç¬¬ 6.3.2 èŠ‚"è°ƒæ•´è®¡ç®—"å®Œå…¨é‡å†™

**åˆ é™¤åŸå†…å®¹**ï¼Œæ›¿æ¢ä¸ºï¼š

```markdown
#### 6.3.2 æ­£ç¡®çš„ä½ç½®è°ƒæ•´ç®—æ³•

**å…³é”®çŸ¥è¯†ç‚¹**ï¼š
1. âœ… `unionBBox.x` å’Œ `unionBBox.y` æ˜¯**ç»å¯¹åæ ‡**ï¼ˆç›¸å¯¹äºç”»å¸ƒï¼‰
2. âœ… å®¹å™¨æ–°ä½ç½® = `unionBBox.x - PADDING`ï¼ˆç›´æ¥è®¡ç®—ï¼Œä¸éœ€è¦ç›¸å¯¹è½¬æ¢ï¼‰
3. âœ… å¿…é¡»ä½¿ç”¨ `translate()` ç§»åŠ¨å®¹å™¨ï¼Œæ‰èƒ½è®©å­èŠ‚ç‚¹è‡ªåŠ¨è·Ÿéš
4. âœ… **ä¸èƒ½ä½¿ç”¨** `setPosition()` æˆ– `position()`ï¼Œå¦åˆ™å­èŠ‚ç‚¹ä¸ä¼šè·Ÿéš

**å®Œæ•´ç®—æ³•**ï¼š
```typescript
// 1. è·å–å­èŠ‚ç‚¹å¹¶é›†åŒ…å›´ç›’ï¼ˆç»å¯¹åæ ‡ï¼‰
const unionBBox = graph.getCellsBBox(children)
if (!unionBBox) {
  // ç©ºå®¹å™¨å¤„ç†
  container.resize(MIN_WIDTH, MIN_HEIGHT)
  return
}

// 2. è®¡ç®—å®¹å™¨æ–°ä½ç½®ï¼ˆç»å¯¹åæ ‡ï¼‰
const newX = unionBBox.x - PADDING
const newY = unionBBox.y - PADDING

// 3. è®¡ç®—å®¹å™¨æ–°å°ºå¯¸
const newWidth = Math.max(unionBBox.width + PADDING * 2, MIN_WIDTH)
const newHeight = Math.max(unionBBox.height + PADDING * 2, MIN_HEIGHT)

// 4. è®¡ç®—ä½ç½®åç§»é‡
const oldPos = container.getPosition()
const dx = newX - oldPos.x
const dy = newY - oldPos.y

// 5. åº”ç”¨ä½ç½®è°ƒæ•´ï¼ˆä½¿ç”¨ translateï¼‰
if (Math.abs(dx) > THRESHOLD || Math.abs(dy) > THRESHOLD) {
  container.translate(dx, dy)  // âœ… å­èŠ‚ç‚¹ä¼šè‡ªåŠ¨è·Ÿéš
}

// 6. åº”ç”¨å°ºå¯¸è°ƒæ•´
container.resize(newWidth, newHeight)
```

**ä¸ºä»€ä¹ˆå¿…é¡»ç”¨ translate()ï¼Ÿ**

æ ¹æ® X6 å®˜æ–¹æ–‡æ¡£å’Œå®æµ‹éªŒè¯ï¼ˆQ3ï¼‰ï¼š
- âœ… `translate(dx, dy)` ä¼šè§¦å‘ X6 å†…éƒ¨çš„å­èŠ‚ç‚¹è·Ÿéšæœºåˆ¶
- âŒ `setPosition(x, y)` ä¸ä¼šè§¦å‘å­èŠ‚ç‚¹è·Ÿéšï¼Œå­èŠ‚ç‚¹ä¼š"é£å‡º"å®¹å™¨

**éªŒè¯ç»“æœ**ï¼š
```
ä½¿ç”¨ container.translate(-20, -20)ï¼š
- å®¹å™¨ä» (100, 100) ç§»åŠ¨åˆ° (80, 80)
- å­èŠ‚ç‚¹ä» (150, 150) è‡ªåŠ¨è·Ÿéšåˆ° (130, 130) âœ…

ä½¿ç”¨ container.setPosition(80, 80)ï¼š
- å®¹å™¨ä» (100, 100) ç§»åŠ¨åˆ° (80, 80)
- å­èŠ‚ç‚¹ä¿æŒåœ¨ (150, 150) âŒ æ²¡æœ‰è·Ÿéš
```

å‚è€ƒï¼š`X6åæ ‡ç³»ç»ŸéªŒè¯æŠ¥å‘Š.md` ç¬¬ 4.3 èŠ‚
```

---

### 4.3 ç¬¬ 5.2.2 èŠ‚"å¤šèŠ‚ç‚¹å¹¶é›†åŒ…å›´ç›’"ä¿®æ­£

**åŸé”™è¯¯**ï¼š
```typescript
const unionBBox = Graph.getCellsBBox(children)
```

**ä¿®æ­£ä¸º**ï¼š
```typescript
// âœ… æ³¨æ„ï¼šgetCellsBBox() æ˜¯ graph å®ä¾‹æ–¹æ³•ï¼Œä¸æ˜¯é™æ€æ–¹æ³•
const unionBBox = graph.getCellsBBox(children)
// è¿”å›ï¼š{ x, y, width, height } æˆ– nullï¼ˆå½“ children ä¸ºç©ºæ—¶ï¼‰

// åæ ‡è¯´æ˜ï¼š
// - unionBBox.x å’Œ unionBBox.y æ˜¯**ç»å¯¹åæ ‡**ï¼ˆç›¸å¯¹äºç”»å¸ƒï¼‰
// - ä¸éœ€è¦è¿›è¡Œä»»ä½•åæ ‡è½¬æ¢
```

---

## äº”ã€éœ€è¦è¡¥å……çš„å…³é”®çŸ¥è¯†

### 5.1 æ–°å¢ 5.3 èŠ‚"X6 åæ ‡ç³»ç»Ÿï¼ˆå®˜æ–¹éªŒè¯ï¼‰"

åœ¨ç¬¬ 5 èŠ‚"åŒ…å›´ç›’è®¡ç®—"ä¸­ï¼Œåˆ é™¤åŸ 5.3.1 å’Œ 5.3.2ï¼Œæ›¿æ¢ä¸ºï¼š

```markdown
### 5.3 X6 åæ ‡ç³»ç»Ÿï¼ˆå®˜æ–¹éªŒè¯ï¼‰

#### 5.3.1 æ ¸å¿ƒäº‹å®

æ ¹æ® X6 å®˜æ–¹æ–‡æ¡£å’Œå®æµ‹éªŒè¯ï¼ˆè¯¦è§ `X6åæ ‡ç³»ç»ŸéªŒè¯æŠ¥å‘Š.md`ï¼‰ï¼š

1. âœ… `node.getPosition()` é»˜è®¤è¿”å›**ç»å¯¹åæ ‡**ï¼ˆç›¸å¯¹äºç”»å¸ƒï¼‰
2. âœ… `node.getBBox()` è¿”å›çš„åæ ‡ä¹Ÿæ˜¯**ç»å¯¹åæ ‡**
3. âœ… `graph.getCellsBBox()` è¿”å›çš„åæ ‡ä¹Ÿæ˜¯**ç»å¯¹åæ ‡**
4. âœ… ä»…å½“è°ƒç”¨ `position({ relative: true })` æ—¶æ‰è¿”å›ç›¸å¯¹åæ ‡

**é‡è¦**ï¼šX6 çš„ `addChild()` **ä¸ä¼šæ”¹å˜**å­èŠ‚ç‚¹çš„åæ ‡å€¼ï¼Œå­èŠ‚ç‚¹å§‹ç»ˆä½¿ç”¨ç»å¯¹åæ ‡ã€‚

#### 5.3.2 å®˜æ–¹æ–‡æ¡£ä¾æ®

**position() API æ–‡æ¡£**ï¼š
> | åç§° | ç±»å‹ | å¿…é€‰ | é»˜è®¤å€¼ | æè¿° |
> | --- | --- | --- | --- | --- |
> | options.relative | boolean |  | **false** | æ˜¯å¦è¿”å›ç›¸å¯¹äºçˆ¶èŠ‚ç‚¹çš„ç›¸å¯¹ä½ç½®ï¼Œ**é»˜è®¤ä¸º false è¡¨ç¤ºè¿”å›èŠ‚ç‚¹ç›¸å¯¹äºç”»å¸ƒçš„ç»å¯¹ä½ç½®**ã€‚ |

æ¥æºï¼šhttps://x6.antv.vision/zh/docs/api/model/node#position

**ç¾¤ç»„æ–‡æ¡£**ï¼š
> "éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå­èŠ‚ç‚¹çš„ä½ç½®æ˜¯ç›¸å¯¹ç”»å¸ƒå·¦ä¸Šè§’çš„ä½ç½®ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰æä¾›ç›¸å¯¹çˆ¶èŠ‚ç‚¹çš„ç›¸å¯¹å®šä½æ–¹æ³•ã€‚"

æ¥æºï¼šhttps://x6.antv.vision/zh/docs/tutorial/basic/group

#### 5.3.3 éªŒè¯ç»“æœ

**Q1 éªŒè¯**ï¼ˆ`getBBox()` åæ ‡ç³»ï¼‰ï¼š
- å®¹å™¨ä½ç½®ï¼š(100, 100)
- å­èŠ‚ç‚¹ä½ç½®ï¼š(150, 150)
- å­èŠ‚ç‚¹ `getBBox()`ï¼š`{ x: 150, y: 150, ... }`
- **ç»“è®º**ï¼šâœ… è¿”å›**ç»å¯¹åæ ‡**ï¼ˆx = 150ï¼Œä¸æ˜¯ç›¸å¯¹å€¼ 50ï¼‰

**Q2 éªŒè¯**ï¼ˆ`getCellsBBox()` åæ ‡ç³»ï¼‰ï¼š
- å®¹å™¨ä½ç½®ï¼š(100, 100)
- å­èŠ‚ç‚¹1ï¼š(150, 150)
- å­èŠ‚ç‚¹2ï¼š(250, 250)
- å¹¶é›† `getCellsBBox()`ï¼š`{ x: 150, y: 150, width: 150, height: 150 }`
- **ç»“è®º**ï¼šâœ… è¿”å›**ç»å¯¹åæ ‡**ï¼ˆx = 150ï¼Œä¸æ˜¯ç›¸å¯¹å€¼ 50ï¼‰

#### 5.3.4 å®ç°å½±å“

âœ… **å¥½æ¶ˆæ¯**ï¼šåæ ‡è®¡ç®—æ¯”åŸæ–¹æ¡ˆ**æ›´ç®€å•**

```typescript
// âŒ åŸæ–¹æ¡ˆé”™è¯¯å‡è®¾éœ€è¦è½¬æ¢
const bbox = node.getBBox()
const absoluteBBox = {
  x: bbox.x + parentPos.x,  // é”™è¯¯ï¼é‡å¤è®¡ç®—
  y: bbox.y + parentPos.y
}

// âœ… æ­£ç¡®åšæ³•ï¼šç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€è½¬æ¢
const bbox = node.getBBox()  // å·²ç»æ˜¯ç»å¯¹åæ ‡
const unionBBox = graph.getCellsBBox(children)  // å·²ç»æ˜¯ç»å¯¹åæ ‡

// âœ… å®¹å™¨æ–°ä½ç½® = åŒ…å›´ç›’å·¦ä¸Šè§’ - PADDING
const newX = unionBBox.x - PADDING
const newY = unionBBox.y - PADDING
```
```

---

### 5.2 æ–°å¢ 6.3.3 èŠ‚"translate() vs setPosition()"

åœ¨ç¬¬ 6.3 èŠ‚"ä½ç½®è°ƒæ•´ç­–ç•¥"ä¸­æ–°å¢ï¼š

```markdown
#### 6.3.3 translate() vs setPosition()

**å…³é”®å·®å¼‚**ï¼š

| æ–¹æ³• | å­èŠ‚ç‚¹è·Ÿéš | é€‚ç”¨åœºæ™¯ |
|-----|-----------|---------|
| `translate(dx, dy)` | âœ… **ä¼šè·Ÿéš** | å®¹å™¨æ‰©å®¹ã€æ‹–æ‹½ç§»åŠ¨ |
| `setPosition(x, y)` | âŒ **ä¸è·Ÿéš** | åˆå§‹åŒ–ä½ç½®ï¼ˆæ— å­èŠ‚ç‚¹æ—¶ï¼‰ |
| `position(x, y)` | âŒ **ä¸è·Ÿéš** | åŒ `setPosition` |

**éªŒè¯ç»“æœ**ï¼ˆQ3ï¼‰ï¼š

```typescript
// æµ‹è¯•åœºæ™¯ï¼šå®¹å™¨(100,100)ï¼Œå­èŠ‚ç‚¹(150,150)

// âœ… ä½¿ç”¨ translate()
container.translate(-20, -20)
// ç»“æœï¼š
// - å®¹å™¨ï¼š(100,100) â†’ (80,80) âœ…
// - å­èŠ‚ç‚¹ï¼š(150,150) â†’ (130,130) âœ… è‡ªåŠ¨è·Ÿéš

// âŒ ä½¿ç”¨ setPosition()
container.setPosition(80, 80)
// ç»“æœï¼š
// - å®¹å™¨ï¼š(100,100) â†’ (80,80) âœ…
// - å­èŠ‚ç‚¹ï¼š(150,150) â†’ (150,150) âŒ æ²¡æœ‰è·Ÿéšï¼ˆé£å‡ºå®¹å™¨ï¼‰
```

**å®˜æ–¹æ–‡æ¡£è¯´æ˜**ï¼š
> "å½“ç§»åŠ¨çˆ¶èŠ‚ç‚¹æ—¶å­èŠ‚ç‚¹ä¹Ÿä¼šè·Ÿç€ç§»åŠ¨ã€‚å®é™…ä¸Šï¼Œå³ä¾¿å­èŠ‚ç‚¹ä½äºçˆ¶èŠ‚ç‚¹å¤–éƒ¨ï¼Œç§»åŠ¨çˆ¶èŠ‚ç‚¹æ—¶å­èŠ‚ç‚¹ä¹Ÿå°†è·Ÿç€ç§»åŠ¨ã€‚"
>
> æ¥æºï¼šhttps://x6.antv.vision/zh/docs/tutorial/basic/group

**æ‰©å®¹ç®—æ³•å¿…é¡»ä½¿ç”¨ translate()**ï¼š

```typescript
// âœ… æ­£ç¡®ç¤ºä¾‹
function autoExpandContainer(container: Node, graph: Graph) {
  const unionBBox = graph.getCellsBBox(children)
  const newX = unionBBox.x - PADDING
  const newY = unionBBox.y - PADDING
  
  const oldPos = container.getPosition()
  const dx = newX - oldPos.x
  const dy = newY - oldPos.y
  
  // âœ… å…³é”®ï¼šä½¿ç”¨ translate()
  container.translate(dx, dy)
  container.resize(newWidth, newHeight)
}

// âŒ é”™è¯¯ç¤ºä¾‹
function autoExpandContainer(container: Node, graph: Graph) {
  // ...
  // âŒ ä½¿ç”¨ setPosition() ä¼šå¯¼è‡´å­èŠ‚ç‚¹é£å‡º
  container.setPosition(newX, newY)  // å­èŠ‚ç‚¹ä¸ä¼šè·Ÿéšï¼
  container.resize(newWidth, newHeight)
}
```

**é‡è¦æç¤º**ï¼š
- âœ… è¿™æ˜¯ X6 çš„**é»˜è®¤è¡Œä¸º**ï¼Œä¸éœ€è¦å¯ç”¨ `embedding` é…ç½®
- âœ… `embedding` é…ç½®ä»…ç”¨äº**äº¤äº’å¼æ‹–å…¥**åˆ›å»ºçˆ¶å­å…³ç³»ï¼Œä¸ç§»åŠ¨è·Ÿéšæ— å…³
```

---

## å…­ã€ä¿®æ­£å»ºè®®æ±‡æ€»

### 6.1 å¿…é¡»ä¿®æ”¹çš„ç« èŠ‚

| ç« èŠ‚ | æ“ä½œ | ä¼˜å…ˆçº§ |
|-----|------|--------|
| 5.2.2 | ä¿®æ­£ `Graph.getCellsBBox()` â†’ `graph.getCellsBBox()` | ğŸ”´ P0 |
| 5.3.1 | **åˆ é™¤**"ç›¸å¯¹åæ ‡å½±å“" | ğŸ”´ P0 |
| 5.3.2 | **åˆ é™¤** `getAbsoluteBBox()` å‡½æ•° | ğŸ”´ P0 |
| 5.3 | **æ–°å¢**"X6 åæ ‡ç³»ç»Ÿï¼ˆå®˜æ–¹éªŒè¯ï¼‰" | ğŸ”´ P0 |
| 6.1.1 | ä¿®æ­£ç®—æ³•ä¼ªç ï¼ˆæ­¥éª¤ 7ï¼‰ | ğŸ”´ P0 |
| 6.3.2 | **å®Œå…¨é‡å†™**"è°ƒæ•´è®¡ç®—"ç®—æ³• | ğŸ”´ P0 |
| 6.3.3 | **æ–°å¢**"translate() vs setPosition()" | ğŸ”´ P0 |

### 6.2 å¯é€‰ä¼˜åŒ–é¡¹

| ç« èŠ‚ | å»ºè®® | ä¼˜å…ˆçº§ |
|-----|------|--------|
| 3.2 | æ¶æ„æµç¨‹å›¾ä¸­è¡¥å……"ä½¿ç”¨ translate ç§»åŠ¨" | âš ï¸ P1 |
| 8.1.3 | ä¿®æ­£å®ç°æ–¹æ¡ˆä¸­çš„ `position()` â†’ `translate()` | âš ï¸ P1 |
| 11.3 Q2 | æ›´æ–°"æ‰©å®¹åå­èŠ‚ç‚¹ä½ç½®è·³å˜"çš„ç­”æ¡ˆ | âš ï¸ P2 |

### 6.3 éœ€è¦æ·»åŠ çš„å¼•ç”¨

åœ¨æ–‡æ¡£å¼€å¤´"å‚è€ƒèµ„æ–™"ä¸­è¡¥å……ï¼š

```markdown
## å‚è€ƒèµ„æ–™

### X6 å®˜æ–¹æ–‡æ¡£
- [Node API - position()](https://x6.antv.vision/zh/docs/api/model/node#position)
- [Node API - getBBox()](https://x6.antv.vision/zh/docs/api/model/node#getbbox)
- [Node API - resize()](https://x6.antv.vision/zh/docs/api/model/node#resize)
- [ç¾¤ç»„ Group](https://x6.antv.vision/zh/docs/tutorial/basic/group)

### é¡¹ç›®éªŒè¯æ–‡æ¡£
- `docs/04-å®¹å™¨è‡ªåŠ¨æ‰©å®¹/X6åæ ‡ç³»ç»ŸéªŒè¯æŠ¥å‘Š.md`
- `docs/04-å®¹å™¨è‡ªåŠ¨æ‰©å®¹/éªŒè¯æ‰§è¡ŒæŒ‡å—.md`
- `docs/04-å®¹å™¨è‡ªåŠ¨æ‰©å®¹/APIä¿®æ­£è¯´æ˜.md`
```

---

## ä¸ƒã€éªŒè¯æ¸…å•

ä¿®æ”¹å®Œæˆåï¼Œè¯·éªŒè¯ä»¥ä¸‹å†…å®¹ï¼š

### 7.1 ç®—æ³•éªŒè¯
- [ ] ç¬¬ 6.1.1 èŠ‚ç®—æ³•ä¼ªç ä¸­ä½¿ç”¨ `translate(dx, dy)`
- [ ] ç¬¬ 6.3.2 èŠ‚ç®—æ³•ä½¿ç”¨ç»å¯¹åæ ‡è®¡ç®—ï¼ˆä¸åšè½¬æ¢ï¼‰
- [ ] æ‰€æœ‰ `Graph.getCellsBBox()` æ”¹ä¸º `graph.getCellsBBox()`

### 7.2 çŸ¥è¯†éªŒè¯
- [ ] ç¬¬ 5.3 èŠ‚æ˜ç¡®è¯´æ˜"ç»å¯¹åæ ‡"
- [ ] ç¬¬ 6.3.3 èŠ‚è§£é‡Š `translate()` vs `setPosition()` å·®å¼‚
- [ ] åˆ é™¤æ‰€æœ‰"ç›¸å¯¹åæ ‡"ç›¸å…³çš„é”™è¯¯æè¿°

### 7.3 ä¸€è‡´æ€§éªŒè¯
- [ ] æ–‡æ¡£ä¸­æ‰€æœ‰ç¤ºä¾‹ä»£ç ä½¿ç”¨æ­£ç¡®çš„ API
- [ ] æ–‡æ¡£ç»“è®ºä¸éªŒè¯æŠ¥å‘Šä¸€è‡´
- [ ] å‚è€ƒé“¾æ¥æŒ‡å‘å®˜æ–¹æ–‡æ¡£

---

## å…«ã€æ€»ç»“

### 8.1 æ ¸å¿ƒé—®é¢˜

åŸæ–¹æ¡ˆæ–‡æ¡£åŸºäº**é”™è¯¯çš„åæ ‡ç³»ç»Ÿå‡è®¾**ï¼Œå¯¼è‡´ï¼š
1. ğŸ”´ **ç®—æ³•é”™è¯¯**ï¼šä½ç½®è®¡ç®—å…¬å¼å®Œå…¨é”™è¯¯
2. ğŸ”´ **æ–¹æ³•é”™è¯¯**ï¼šä½¿ç”¨ `setPosition()` å¯¼è‡´å­èŠ‚ç‚¹ä¸è·Ÿéš
3. ğŸ”´ **æ¦‚å¿µé”™è¯¯**ï¼šè®¾è®¡äº†ä¸å¿…è¦çš„åæ ‡è½¬æ¢å‡½æ•°

### 8.2 ä¿®æ­£è¦ç‚¹

1. âœ… `getBBox()` å’Œ `getCellsBBox()` è¿”å›**ç»å¯¹åæ ‡**
2. âœ… å®¹å™¨æ–°ä½ç½® = `unionBBox.x - PADDING`ï¼ˆç›´æ¥è®¡ç®—ï¼‰
3. âœ… å¿…é¡»ä½¿ç”¨ `translate(dx, dy)` ç§»åŠ¨å®¹å™¨
4. âœ… ä¸éœ€è¦ä»»ä½•åæ ‡è½¬æ¢ï¼Œé€»è¾‘åè€Œæ›´ç®€å•

### 8.3 ä¿®æ­£åçš„æ­£ç¡®ç®—æ³•

```typescript
function autoExpandContainer(container: Node, graph: Graph) {
  const children = container.getChildren()
  
  // 1. ç©ºå®¹å™¨å¤„ç†
  if (!children || children.length === 0) {
    container.resize(MIN_WIDTH, MIN_HEIGHT)
    return
  }
  
  // 2. è®¡ç®—å¹¶é›†åŒ…å›´ç›’ï¼ˆç»å¯¹åæ ‡ï¼‰
  const unionBBox = graph.getCellsBBox(children)
  if (!unionBBox) return
  
  // 3. è®¡ç®—æ–°ä½ç½®ï¼ˆç»å¯¹åæ ‡ï¼‰
  const newX = unionBBox.x - PADDING
  const newY = unionBBox.y - PADDING
  
  // 4. è®¡ç®—æ–°å°ºå¯¸
  const newWidth = Math.max(unionBBox.width + PADDING * 2, MIN_WIDTH)
  const newHeight = Math.max(unionBBox.height + PADDING * 2, MIN_HEIGHT)
  
  // 5. è®¡ç®—åç§»é‡
  const oldPos = container.getPosition()
  const dx = newX - oldPos.x
  const dy = newY - oldPos.y
  
  // 6. åº”ç”¨ä½ç½®è°ƒæ•´ï¼ˆå­èŠ‚ç‚¹è‡ªåŠ¨è·Ÿéšï¼‰
  if (Math.abs(dx) > THRESHOLD || Math.abs(dy) > THRESHOLD) {
    container.translate(dx, dy)  // âœ… å…³é”®
  }
  
  // 7. åº”ç”¨å°ºå¯¸è°ƒæ•´
  container.resize(newWidth, newHeight)
}
```

---

**è¯„ä¼°äºº**ï¼šAI Assistant  
**è¯„ä¼°çŠ¶æ€**ï¼šâœ… å®Œæˆ  
**ä¸‹ä¸€æ­¥**ï¼šæ ¹æ®æœ¬æŠ¥å‘Šä¿®æ­£ `04-å®¹å™¨è‡ªåŠ¨æ‰©å®¹.md` æ–‡æ¡£
