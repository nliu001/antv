# Step 1 基础画布搭建 - 问题澄清确认

## 目录
- [1. 澄清问题汇总](#1-澄清问题汇总)
- [2. 设计决策影响分析](#2-设计决策影响分析)
- [3. 文档修正清单](#3-文档修正清单)

---

## 1. 澄清问题汇总

### 问题 1：是否支持触摸设备？
**决策**：❌ 不支持

**影响范围**：
- 无需配置 `interacting.touch` 相关参数
- 测试用例无需覆盖触摸交互
- 目标平台明确为桌面端

**文档更新**：
- 在"1.2 前置依赖"中明确说明：本系统仅支持桌面端浏览器
- 移除所有触摸相关的配置说明

---

### 问题 2：网格类型选择
**决策**：✅ 线状网格（mesh）

**理由**：
- 设备拓扑图场景下，线状网格提供更清晰的空间参考
- 便于用户目测节点间距和对齐关系
- 与专业拓扑图工具的视觉习惯一致

**配置变更**：
```typescript
// 修改前
grid: {
  type: 'dot'  // 点状网格
}

// 修改后
grid: {
  type: 'mesh'  // 线状网格
}
```

**文档更新**：
- 5.1.2 关键参数中的 grid 配置
- 增加网格类型选择理由说明

---

### 问题 3：适应画布在空画布时的行为
**决策**：✅ 采用 AntV X6 默认策略

**说明**：
- 不对 `zoomToFit` 的空画布行为做特殊处理
- X6 默认行为：空画布时不执行任何操作
- 避免额外的逻辑复杂度

**文档更新**：
- 7.2.2 功能按钮中移除"空画布时不报错"的描述
- 简化为：调用 X6 原生 `zoomToFit` 方法

---

### 问题 4：全屏模式的实现细节
**决策**：❌ 取消全屏功能

**影响范围**：
- Toolbar 组件移除全屏按钮
- 无需实现 `Fullscreen API` 相关逻辑
- 减少实现复杂度

**文档更新**：
- 7.2.2 功能按钮中删除"全屏"相关内容
- 工时估算相应减少约 0.5h

---

### 问题 5：画布容器的默认尺寸策略
**决策**：✅ 父容器一定会有高度和宽度

**约束条件**：
- 由上层应用（App.vue）保证容器尺寸
- GraphCanvas 组件无需处理默认尺寸
- 简化组件实现逻辑

**文档更新**：
- 7.1.2 Props 定义中增加使用前提说明
- 10.4 常见问题 Q1 中增加父容器尺寸要求

---

### 问题 6：ResizeObserver 的兼容性处理
**决策**：✅ 目标浏览器为 Chrome 和 Edge

**兼容性确认**：
- Chrome 64+：✅ 支持 ResizeObserver
- Edge 79+（基于 Chromium）：✅ 支持 ResizeObserver
- 无需 Polyfill

**文档更新**：
- 在"1.2 前置依赖"中明确浏览器要求
- 5.3.1 容器尺寸监听中移除兼容性说明

---

### 问题 7：快捷键冲突的处理方式
**决策**：❌ 取消快捷键设置

**影响范围**：
- Toolbar 按钮仅支持鼠标点击
- 移除所有快捷键相关代码
- 简化交互设计

**文档更新**：
- 7.2.2 功能按钮中删除快捷键说明（Ctrl + +、Ctrl + - 等）
- 工时估算相应减少约 0.5h

---

## 2. 设计决策影响分析

### 2.1 功能简化
**移除的功能**：
- ❌ 触摸设备支持
- ❌ 全屏模式
- ❌ 快捷键支持

**工时节省**：约 2-3 小时

**优势**：
- 降低实现复杂度
- 减少测试成本
- 聚焦核心功能

---

### 2.2 配置优化
**明确的配置**：
- ✅ 网格类型：线状（mesh）
- ✅ 目标浏览器：Chrome/Edge
- ✅ 父容器尺寸：由上层保证

**优势**：
- 减少配置歧义
- 避免不必要的兼容性处理
- 清晰的技术边界

---

### 2.3 工时调整
**原估算**：11 小时（审查报告修正后）

**调整后**：
| 任务 | 原工时 | 调整 | 新工时 | 说明 |
|------|--------|------|--------|------|
| T1-6 Toolbar 组件 | 2h | -1h | 1h | 移除全屏和快捷键 |
| T1-8 测试 | 2.5h | -0.5h | 2h | 减少快捷键测试 |

**新总工时**：9 小时（约 1.2 天）

---

## 3. 文档修正清单

### 3.1 必须修正项（P0）
- [x] **1.2 前置依赖**
  - 补充 `@antv/x6-plugin-snapline` 依赖
  - 明确目标浏览器：Chrome 64+ / Edge 79+
  - 明确目标平台：桌面端

- [x] **3.3 Graph 配置策略**
  - 网格类型改为 `mesh`（线状）
  - 缩放范围调整为 0.2 ~ 3

- [x] **5.1.2 关键参数**
  - panning 移除 `modifiers: 'shift'`
  - grid 改为 `type: 'mesh'`
  - mousewheel 调整 minScale/maxScale

- [x] **6.1 Graph Store 结构**
  - 移除 `selectedNodeIds`（Step 1 不需要）
  - 增加 `isInitialized`、`isLoading`、`error`

- [x] **7.2.2 功能按钮**
  - 删除"全屏"按钮说明
  - 删除所有快捷键说明（Ctrl + +、Ctrl + - 等）

- [x] **4.1 任务清单**
  - 调整 T1-6 工时：2h → 1h
  - 调整 T1-8 工时：2.5h → 2h
  - 更新总工时：11h → 9h

---

### 3.2 建议优化项（P1）
- [ ] **5.1.2 关键参数**
  - 增加网格类型选择理由说明
  - 网格与对齐线冲突处理（采用审查报告方案 A）

- [ ] **7.1.2 Props 定义**
  - 增加父容器尺寸要求说明

- [ ] **10.4 常见问题**
  - Q1 增加父容器尺寸要求
  - 删除与快捷键相关的 Q&A

---

### 3.3 文档结构优化
- [ ] 统一防抖延迟说明（150ms）
- [ ] 完善错误处理机制描述
- [ ] 增加浏览器兼容性说明章节

---

## 4. 最终配置参数总结

### 4.1 Graph 核心配置
```typescript
{
  // 网格系统
  grid: {
    size: 10,
    visible: true,
    type: 'mesh'  // ✅ 线状网格
  },
  
  // 对齐线（禁用磁吸避免与网格冲突）
  snapline: {
    enabled: true,
    sharp: false,  // ✅ 关闭磁吸
    tolerance: 10
  },
  
  // 缩放
  mousewheel: {
    enabled: true,
    modifiers: ['ctrl', 'meta'],
    minScale: 0.2,  // ✅ 20%
    maxScale: 3,    // ✅ 300%
    factor: 1.1
  },
  
  // 平移
  panning: {
    enabled: true
    // ✅ 无 modifiers，支持空白区域直接拖拽
  },
  
  // ❌ 无触摸支持
  // interacting: { touch: false }
}
```

### 4.2 GraphState 结构
```typescript
interface GraphState {
  // Graph 实例
  graph: Graph | null
  
  // ✅ 初始化状态
  isInitialized: boolean
  isLoading: boolean
  error: Error | null
  
  // 画布状态
  zoom: number
  centerPoint: { x: number; y: number }
  
  // 交互状态
  isInteracting: boolean
  isPanning: boolean
  isZooming: boolean
  
  // ❌ 移除（Step 1 不需要）
  // selectedNodeIds: string[]
}
```

### 4.3 Toolbar 功能
- ✅ 放大按钮
- ✅ 缩小按钮
- ✅ 适应画布按钮
- ✅ 实际大小按钮（100% 缩放）
- ❌ 全屏按钮（已移除）
- ❌ 快捷键支持（已移除）

---

## 5. 下一步行动

### 5.1 立即执行
1. 根据本确认文档更新 `01-基础画布搭建.md`
2. 同步更新审查报告中的"已修正"状态
3. 更新工时估算为 9 小时（1.2 天）

### 5.2 质量保证
1. 确保所有配置参数一致性
2. 验证文档中无遗留的快捷键/全屏/触摸相关内容
3. 复核工时估算的合理性

---

**确认文档版本**：1.0.0  
**生成时间**：2026-02-09  
**状态**：✅ 已确认  
**下一步**：更新 Step 1 原始文档
